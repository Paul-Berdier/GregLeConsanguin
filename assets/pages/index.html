<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Greg — Web Player</title>

  <script>
    // Boot config (supports both http(s) and opening this file directly via file://)
    (() => {
      const isFile = location.protocol === "file:";
      const STATIC_BASE = isFile ? "../static" : "/static";
      // If you open via file://, point this to your local backend:
      const API_BASE = isFile ? "http://127.0.0.1:8000/api/v1" : "/api/v1";

      window.GREG_STATIC_BASE = STATIC_BASE;
      window.GREG_API_BASE = API_BASE;

      const icon = document.createElement("link");
      icon.rel = "icon";
      icon.type = "image/png";
      icon.href = `${STATIC_BASE}/icon.png`;
      document.head.appendChild(icon);

      const css = document.createElement("link");
      css.rel = "stylesheet";
      css.href = `${STATIC_BASE}/player.css`;
      document.head.appendChild(css);
    })();
  </script>

  <!-- Socket.IO client -->
  <script defer src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body>
  <!-- SVG sprite -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="icon-play" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></symbol>
    <symbol id="icon-pause" viewBox="0 0 24 24"><path fill="currentColor" d="M6 5h4v14H6zm8 0h4v14h-4z"/></symbol>
    <symbol id="icon-skip" viewBox="0 0 24 24"><path fill="currentColor" d="M7 6v12l8.5-6zM17 6h2v12h-2z"/></symbol>
    <symbol id="icon-stop" viewBox="0 0 24 24"><path fill="currentColor" d="M6 6h12v12H6z"/></symbol>
    <symbol id="icon-repeat" viewBox="0 0 24 24"><path fill="currentColor" d="M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"/></symbol>
    <symbol id="icon-trash" viewBox="0 0 24 24"><path fill="currentColor" d="M9 3h6l1 2h5v2H3V5h5zm1 6h2v10h-2zm4 0h2v10h-2z"/></symbol>
    <symbol id="icon-search" viewBox="0 0 24 24"><path fill="currentColor" d="M10 4a6 6 0 1 0 3.6 10.8l4.8 4.8 1.4-1.4-4.8-4.8A6 6 0 0 0 10 4zm0 2a4 4 0 1 1 0 8 4 4 0 0 1 0-8z"/></symbol>
    <symbol id="icon-prev" viewBox="0 0 24 24"><path fill="currentColor" d="M7 6h2v12H7zm3 6l10 6V6z"/></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4.4 0-8 2.2-8 5v1h16v-1c0-2.8-3.6-5-8-5z"/></symbol>
  </svg>

  <div class="app">
    <!-- Header -->
    <header class="topbar">
      <div class="brand">
        <img class="brand-logo" src="" alt="Greg"/>
        <div class="brand-text">
          <div class="brand-title">Greg le Consanguin</div>
          <div class="brand-subtitle">Web Player</div>
        </div>
      </div>

      <form class="search" id="searchForm" autocomplete="off">
        <div class="search-box">
          <svg class="search-icon" viewBox="0 0 24 24"><use href="#icon-search"></use></svg>
          <input
            id="searchInput"
            type="text"
            class="search-input"
            placeholder="Rechercher YouTube / Spotify / SoundCloud…"
            aria-label="Recherche"
          />
          <button type="submit" class="btn btn--primary">
            <span>Ajouter</span>
          </button>
        </div>
        <div id="searchSuggestions" class="search-suggestions"></div>
      </form>

      <div class="top-auth">
        <div class="auth-card">
          <div class="avatar" id="userAvatar">?</div>
          <div class="auth-meta">
            <div class="auth-name" id="userName">Non connecté</div>
            <div class="auth-status" id="userStatus">Discord</div>
          </div>
          <div class="auth-actions">
            <button class="btn btn--ghost" id="btn-login-discord" type="button">Se connecter</button>
            <button class="btn btn--ghost hidden" id="btn-logout-discord" type="button">Se déconnecter</button>
          </div>
        </div>

        <div class="guild-select">
          <label for="guildSelect">Serveur</label>
          <select id="guildSelect">
            <option value="">(par défaut)</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="main">
      <section class="queue">
        <div class="queue-header">
          <div class="queue-title">File d’attente</div>
          <div class="queue-count" id="queueCount">0 titre</div>
        </div>
        <div class="queue-list" id="queueList"></div>
      </section>

      <section class="now-playing">
        <div class="artwork" id="artwork"></div>

        <div class="np-meta">
          <div class="np-title" id="trackTitle">Rien en cours</div>
          <div class="np-artist" id="trackArtist">—</div>

          <div class="progress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-meta">
              <span id="progressCurrent">0:00</span>
              <span id="progressTotal">--:--</span>
            </div>
          </div>
        </div>

        <div class="np-controls">
          <button id="btn-stop" class="control-btn" type="button" title="Stop">
            <svg class="icon" viewBox="0 0 24 24"><use href="#icon-stop"></use></svg>
          </button>

          <button id="btn-prev" class="control-btn" type="button" title="Restart">
            <svg class="icon" viewBox="0 0 24 24"><use href="#icon-prev"></use></svg>
          </button>

          <button id="btn-play-pause" class="control-btn primary" type="button" title="Play / Pause">
            <svg class="icon" viewBox="0 0 24 24"><use id="playPauseUse" href="#icon-play"></use></svg>
          </button>

          <button id="btn-skip" class="control-btn" type="button" title="Skip">
            <svg class="icon" viewBox="0 0 24 24"><use href="#icon-skip"></use></svg>
          </button>

          <button id="btn-repeat" class="control-btn" type="button" title="Repeat">
            <svg class="icon" viewBox="0 0 24 24"><use href="#icon-repeat"></use></svg>
          </button>
        </div>
      </section>

      <section class="spotify">
  <div class="spotify-row">
    <div class="spotify-status">
      <div id="spotifyStatus">Spotify non lié</div>
      <div class="spotify-me" id="spotifyMe"></div>
    </div>

    <div class="spotify-actions">
      <button class="btn btn--ghost" id="btn-spotify-login" type="button">Lier Spotify</button>
      <button class="btn btn--ghost hidden" id="btn-spotify-logout" type="button">Délier</button>
      <button class="btn btn--ghost hidden" id="btn-spotify-load-playlists" type="button">Charger playlists</button>
    </div>
  </div>

  <!-- ✅ PANEL -->
  <div class="spotify-panel" id="spotifyPanel">
    <div class="spotify-toolbar">
      <div class="spotify-toolbar-left">
        <select id="spotifyPlaylistSelect" class="spotify-select">
          <option value="">— Playlist —</option>
        </select>
      </div>

      <div class="spotify-toolbar-right">
        <button class="btn btn--ghost" id="btn-spotify-add-current" type="button">Ajouter le titre</button>
        <button class="btn btn--ghost" id="btn-spotify-add-queue" type="button">Ajouter la queue</button>
      </div>
    </div>

    <div class="spotify-grid">
      <div class="spotify-col" id="spotifyPlaylistsWrap">
        <div class="spotify-col-title">Playlists</div>
        <div class="spotify-list" id="spotifyPlaylists"></div>
      </div>

      <div class="spotify-col" id="spotifyTracksWrap">
        <div class="spotify-col-title">Titres</div>
        <div class="spotify-list" id="spotifyTracks"></div>
      </div>
    </div>

    <form id="spotifySearchForm" class="spotify-search" autocomplete="off">
      <input id="spotifySearchInput" class="spotify-search-input" placeholder="Rechercher un titre Spotify…" />
      <button class="btn btn--primary" type="submit">Chercher</button>
    </form>

    <div class="spotify-search-results" id="spotifySearchResults"></div>

    <div class="spotify-create">
      <input id="spotifyCreateName" class="spotify-create-input" placeholder="Nom de playlist (ex: Greg Bangers)" />
      <label class="spotify-create-check">
        <input id="spotifyCreatePublic" type="checkbox" checked />
        <span>Publique</span>
      </label>
      <button class="btn btn--primary" id="btn-spotify-create-playlist" type="button">Créer playlist</button>
    </div>
  </div>
</section>

    </main>

    <!-- Status (bottom) -->
    <footer class="status-bar" id="statusBar">
      <div class="status-message" id="statusMessage">
        <div class="status-text" id="statusText">Initialisation…</div>
      </div>
    </footer>
  </div>

  <script>
    // Late boot: set logo src + load the player script from the right base
    (() => {
      const base = window.GREG_STATIC_BASE || "/static";

      const logo = document.querySelector(".brand-logo");
      if (logo) logo.setAttribute("src", `${base}/icon.png`);

      const s = document.createElement("script");
      s.src = `${base}/player.js`;
      s.defer = true;
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
