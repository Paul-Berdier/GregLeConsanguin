<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Greg le Consanguin ‚Äî Web Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Favicon / App icon -->
  <link rel="icon" type="image/png" href="/static/icon.png" />

  <!-- CSS du player -->
  <link rel="stylesheet" href="/static/player.css" />
</head>
<body>
<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar" aria-label="Navigation">
    <div class="sidebar-header">
      <div class="brand">
        <img class="brand-logo" src="/static/icon.png" alt="Greg" />
        <div class="brand-text">
          <div class="brand-title">Greg le Consanguin</div>
          <div class="brand-subtitle">Web Player</div>
        </div>
      </div>
    </div>

    <nav class="nav">
      <button class="nav-item nav-item--active" id="nav-player" type="button" aria-current="page">
        <span class="nav-icon">üéß</span>
        <span class="nav-label">Lecteur</span>
      </button>
      <button class="nav-item" id="nav-settings" type="button">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-label">Param√®tres</span>
      </button>
      <button class="nav-item" id="nav-about" type="button">
        <span class="nav-icon">ü§°</span>
        <span class="nav-label">√Ä propos</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <div class="card card--compact">
        <div class="user-info" id="userInfo">
          <div class="avatar" id="userAvatar" aria-hidden="true">?</div>
          <div class="user-texts">
            <div class="user-name" id="userName">Non connect√©</div>
            <div class="user-status" id="userStatus">Discord</div>
          </div>
        </div>

        <div class="user-actions">
          <button class="btn btn--primary" id="btn-login-discord" type="button">
            Se connecter avec Discord
          </button>
          <button class="btn btn--ghost hidden" id="btn-logout-discord" type="button">
            Se d√©connecter
          </button>
        </div>

        <div class="server-info">
          <label for="guildSelect">Serveur Discord</label>
          <select id="guildSelect" class="select">
            <option value="">(par d√©faut)</option>
          </select>
          <div class="hint">Choisis le serveur que Greg doit contr√¥ler.</div>
        </div>
      </div>

      <div class="footer-hint">
        <span class="dot dot--ok" aria-hidden="true"></span>
        <span id="footerStatusText">Connecte-toi pour contr√¥ler Greg</span>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main" aria-label="Player">
    <!-- Top status -->
    <div class="topbar">
      <div class="top-status" id="topStatus">
        <span class="pill" id="statusPill">INFO</span>
        <span class="status-text" id="statusText">En attente de Greg‚Ä¶</span>
      </div>

      <div class="top-actions">
        <a class="link" href="/healthz" target="_blank" rel="noopener">Health</a>
        <a class="link" href="/api/v1/guilds" target="_blank" rel="noopener">API</a>
      </div>
    </div>

    <!-- Player view -->
    <section class="view" id="view-player">
      <section class="hero">
        <div class="hero-left">
          <h1>Contr√¥le Greg depuis ton navigateur</h1>
          <p class="lead">
            Lance de la musique, saute des titres, surveille la file d‚Äôattente
            de ton serveur Discord ‚Äî sans ouvrir Discord.
          </p>

          <form id="searchForm" class="search-form" autocomplete="off">
            <div class="search-field">
              <span class="search-icon" aria-hidden="true">üîé</span>
              <input
                id="searchInput"
                class="search-input"
                type="text"
                placeholder="Colle un lien YouTube / Spotify ou tape une recherche‚Ä¶"
                autocomplete="off"
              />
            </div>
            <button class="btn btn--primary btn--cta" type="submit">
              ‚ñ∂Ô∏è Lire
            </button>
          </form>

          <div class="search-suggestions" id="searchSuggestions" aria-live="polite"></div>

          <div class="mini-tips">
            <div class="tip">üí° Astuce : tape <strong>‚Äúartist - title‚Äù</strong> pour chercher vite.</div>
            <div class="tip">üß™ Si √ßa r√©pond pas : v√©rifie le serveur s√©lectionn√© + login Discord.</div>
          </div>
        </div>

        <div class="hero-right">
          <div class="player-card">
            <div class="player-header">
              <div class="artwork" id="artwork" aria-label="Pochette">üéµ</div>
              <div class="track-texts">
                <div class="track-title" id="trackTitle">Rien en cours</div>
                <div class="track-artist" id="trackArtist">Greg dort encore</div>
              </div>
            </div>

            <div class="progress">
              <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                <div class="progress-fill" id="progressFill"></div>
              </div>
              <div class="progress-times">
                <span id="progressCurrent">0:00</span>
                <span class="sep">/</span>
                <span id="progressTotal">0:00</span>
              </div>
            </div>

            <div class="controls">
              <button class="ctrl-btn" id="btn-prev" type="button" disabled title="Pr√©c√©dent">‚èÆ</button>
              <button class="ctrl-btn ctrl-btn--main" id="btn-play-pause" type="button" title="Play / Pause">‚ñ∂Ô∏è</button>
              <button class="ctrl-btn" id="btn-skip" type="button" title="Suivant">‚è≠</button>
              <button class="ctrl-btn" id="btn-stop" type="button" title="Stop">‚èπ</button>
              <button class="ctrl-btn" id="btn-repeat" type="button" title="R√©p√©ter">üîÅ</button>
            </div>

            <div class="spotify">
              <div class="spotify-row">
                <div class="spotify-badge">
                  <span class="spotify-dot" aria-hidden="true"></span>
                  <span class="spotify-status" id="spotifyStatus">Spotify non li√©</span>
                </div>
                <div class="spotify-actions">
                  <button class="btn btn--ghost" id="btn-spotify-login" type="button">Lier Spotify</button>
                  <button class="btn btn--ghost hidden" id="btn-spotify-logout" type="button">D√©-lier</button>
                </div>
              </div>
              <div class="hint">
                Si rien ne s‚Äôouvre, copie le lien propos√© par Greg (mode manuel).
              </div>
            </div>
          </div>

          <div class="stats-card">
            <div class="stat">
              <div class="stat-k" id="statQueue">‚Äî</div>
              <div class="stat-l">Titres en file</div>
            </div>
            <div class="stat">
              <div class="stat-k" id="statGuild">‚Äî</div>
              <div class="stat-l">Serveur</div>
            </div>
            <div class="stat">
              <div class="stat-k" id="statConn">‚Äî</div>
              <div class="stat-l">Connexion</div>
            </div>
          </div>
        </div>
      </section>

      <section class="queue-card">
        <div class="queue-header">
          <h2>File d‚Äôattente</h2>
          <span class="queue-count" id="queueCount">0 titres</span>
        </div>
        <div class="queue-list" id="queueList"></div>
      </section>
    </section>

    <!-- Settings view -->
    <section class="view hidden" id="view-settings">
      <div class="panel">
        <h2>Param√®tres</h2>
        <p class="muted">
          Pour l‚Äôinstant, les r√©glages avanc√©s sont dans l‚Äôoverlay Overwolf.
          Cette page sert de t√©l√©commande.
        </p>

        <div class="panel-grid">
          <div class="card">
            <h3>Serveur API</h3>
            <p class="muted">Base API utilis√©e par le player (d√©j√† en relatif).</p>
            <code class="code">window.GREG_API_BASE = "/api/v1"</code>
          </div>
          <div class="card">
            <h3>Debug</h3>
            <p class="muted">Ouvre la console (F12) et regarde les erreurs r√©seau.</p>
            <p class="muted">Les fichiers doivent charger depuis <code>/static/*</code>.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- About view -->
    <section class="view hidden" id="view-about">
      <div class="panel">
        <h2>√Ä propos</h2>
        <p class="muted">
          Greg le Consanguin est un bot Discord musical sarcastique.
          Ce site permet de contr√¥ler sa playlist √† distance.
        </p>

        <div class="card">
          <h3>Raccourcis</h3>
          <ul class="list">
            <li><strong>Entr√©e</strong> : lancer la recherche</li>
            <li><strong>‚è≠</strong> : skip</li>
            <li><strong>‚èπ</strong> : stop</li>
          </ul>
        </div>
      </div>
    </section>

    <footer class="footer">
      <span>¬© Greg le Consanguin ‚Äî Web Player</span>
      <span class="muted">‚Ä¢</span>
      <span class="muted">Propuls√© par Railway + Flask + Socket.IO</span>
    </footer>
  </main>
</div>

<script>
  window.GREG_API_BASE = "/api/v1";
</script>
<script src="/static/player.js" defer></script>

<!-- micro-switch tabs (sans d√©pendre de player.js) -->
<script>
  (function () {
    const $ = (id) => document.getElementById(id);
    const views = {
      player: $("view-player"),
      settings: $("view-settings"),
      about: $("view-about"),
    };
    const nav = {
      player: $("nav-player"),
      settings: $("nav-settings"),
      about: $("nav-about"),
    };

    function setActive(which) {
      Object.entries(views).forEach(([k, el]) => el?.classList.toggle("hidden", k !== which));
      Object.entries(nav).forEach(([k, el]) => el?.classList.toggle("nav-item--active", k === which));
    }

    nav.player?.addEventListener("click", () => setActive("player"));
    nav.settings?.addEventListener("click", () => setActive("settings"));
    nav.about?.addEventListener("click", () => setActive("about"));
  })();
</script>
</body>
</html>
