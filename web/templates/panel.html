<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ğŸ§ Greg le Consanguin - Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='assets/greg.jpg') }}" type="image/jpeg">
</head>
<body>
    <div class="container">
        <img src="{{ url_for('static', filename='assets/greg.jpg') }}" alt="Greg le Consanguin" class="greg-face{% if current %} playing{% endif %}">
        <h1>Bienvenue, {{ user["username"] }}#{{ user["discriminator"] }}</h1>
        <p class="sarcasme">Encore toiâ€¦ Bon, choisis un serveur oÃ¹ me faire souffrir.</p>

        <!-- SÃ©lection dynamique serveur & salon -->
        <form id="guild-form" autocomplete="off">
            <select name="guild_id" id="guild-select" required>
                {% for guild in guilds %}
                    <option value="{{ guild.id }}" {% if guild.id == selected_guild_id %}selected{% endif %}>
                        {{ guild.name }}
                    </option>
                {% endfor %}
            </select>
            <select name="channel_id" id="channel-select" required>
                {% for channel in channels %}
                    <option value="{{ channel.id }}" {% if channel.id == selected_channel_id %}selected{% endif %}>
                        {{ channel.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit">ğŸ¤ Utiliser ce salon</button>
        </form>

        <!-- Formulaire musique avec autocomplÃ©tion -->
        <form id="play-form" autocomplete="off">
            <form method="post" action="/api/play" id="play-form" autocomplete="off">
                <input id="music-input" name="url" placeholder="Lien ou rechercheâ€¦" required autocomplete="off">
                <input type="hidden" id="guild-id" name="guild_id" value="{{ selected_guild_id or '' }}">
                <input type="hidden" id="channel-id" name="channel_id" value="{{ selected_channel_id or '' }}">
                <button type="submit">ğŸµ JOUER</button>
                <div class="suggestions" id="suggestions" style="display:none;"></div>
            </form>
        </form>

        <div class="current-song">
            {% if current %}
                <h2>ğŸ§ En lecture :</h2>
                <p><a href="{{ current }}" target="_blank" style="color:#ffe066;">{{ current }}</a></p>
            {% endif %}
        </div>

        <div class="playlist">
            <h2>ğŸ“ Playlist actuelle</h2>
            <ul id="playlist-ul">
                {% if playlist %}
                    {% for song in playlist %}
                        <li data-index="{{ loop.index0 }}">
                            <a href="{{ song }}" target="_blank">{{ song }}</a>
                            <button class="play-this" title="Jouer ce morceau">â–¶ï¸</button>
                            <button class="move-top" title="Passer en tÃªte">â«</button>
                        </li>
                    {% endfor %}
                {% else %}
                    <p><em>La playlist est vide. Comme votre goÃ»t musical sans douteâ€¦</em></p>
                {% endif %}
            </ul>
        </div>

        <div class="controls">
            <form><button data-action="pause">â¸ Pause</button></form>
            <form><button data-action="skip">â­ Skip</button></form>
            <form><button data-action="stop">â¹ Stop</button></form>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='greg.js') }}"></script>

</body>
</html>
